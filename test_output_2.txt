
> fairguard-bot@1.0.0 test
> jest

PASS tests/services/ai.test.js
  AI Service
    ç«ãƒ»callGeminiWithRetry ç¸ºï½¯ç¹ï½ªç¹åŒ»Î›ç¹§ï½¤è®–æ»“ï½§ä¹ï½’è¬–âˆšâ–½ (15 ms)
    ç«ãƒ»fetchContext ç¸ºï½¯ç¹§ï½¨ç¹ï½©ç¹ï½¼è­ã‚…â†“ç¹è¼”ã‹ç¹ï½¼ç¹ï½«ç¹èˆŒãƒ£ç¹§ï½¯ç¹§å®šï½¿æ–â˜† (1 ms)

PASS tests/utils/validation.test.js
  Input Validation
    validateLogId
      ç«ãƒ»è­›ç‰™æŸ‘ç¸ºï½ªç¹ï½­ç¹§ï½°IDç¹§è²å¥³ç¸ºå¤§ãƒ»ç¹§å¾Œï½‹ (16 ms)
      ç«ãƒ»é«Ÿï½·ç¸ºå¶â„ƒç¹§ä¹ÎŸç¹§ï½°IDç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹ (1 ms)
      ç«ãƒ»è¾Ÿï½¡èœ‰ï½¹ç¸ºï½ªè­ãƒ»ï½­åŠ±ï½’èœ·ï½«ç¹§Â€ç¹ï½­ç¹§ï½°IDç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹ (1 ms)
      ç«ãƒ»é¨ï½ºç¸ºï½®ç¹ï½­ç¹§ï½°IDç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹
    validateReason
      ç«ãƒ»è­›ç‰™æŸ‘ç¸ºï½ªé€…ãƒ»ç½°ç¹§è²å¥³ç¸ºå¤§ãƒ»ç¹§å¾Œï½‹ (1 ms)
      ç«ãƒ»é«Ÿï½·ç¸ºå¶â„ƒç¹§ç‹—ç‚Šé€•ï½±ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹ (1 ms)
      ç«ãƒ»é¨ï½ºç¸ºï½®é€…ãƒ»ç½°ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹
      ç«ãƒ»è¬¾ï½¹é™¦å¾Œâ€²èŸå£¹â˜†ç¸ºå¼±ï½‹é€…ãƒ»ç½°ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹ (1 ms)
    validateWord
      ç«ãƒ»è­›ç‰™æŸ‘ç¸ºï½ªèœŠå€©ï½ªæ§­ï½’èœ¿åŠ±ï¿ èœˆï½¥ç¹§å¾Œï½‹ (1 ms)
      ç«ãƒ»é«Ÿï½·ç¸ºå¶â„ƒç¹§å¥è…°éš±æ§­ï½’è«¡è²å‡„ç¸ºå¶ï½‹
      ç«ãƒ»è¾Ÿï½¡èœ‰ï½¹ç¸ºï½ªè­ãƒ»ï½­åŠ±ï½’èœ·ï½«ç¹§Â€èœŠå€©ï½ªæ§­ï½’è«¡è²å‡„ç¸ºå¶ï½‹
    validateUserId
      ç«ãƒ»è­›ç‰™æŸ‘ç¸ºï½ªDiscord IDç¹§è²å¥³ç¸ºå¤§ãƒ»ç¹§å¾Œï½‹ (1 ms)
      ç«ãƒ»éï½­ç¸ºå¶â„ƒç¹§ç´€Dç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹
      ç«ãƒ»è¬¨ï½°èŸ„å¶ºï½»ï½¥èŸæ‚¶ï½’èœ·ï½«ç¹§Â€IDç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹
    validateNumber
      ç«ãƒ»è­›ç‰™æŸ‘ç¸ºï½ªè¬¨ï½°è›Ÿï½¤ç¹§è²å¥³ç¸ºå¤§ãƒ»ç¹§å¾Œï½‹
      ç«ãƒ»è­›Â€èŸ†ä¸Â€ï½¤è­›ï½ªè²…Â€ç¸ºï½®è¬¨ï½°è›Ÿï½¤ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹ (1 ms)
      ç«ãƒ»è­›Â€èŸï½§è›Ÿï½¤ç¹§å®šï½¶ãƒ»âˆ´ç¹§åŒºç„šè›Ÿï½¤ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹
      ç«ãƒ»è¬¨ï½°è›Ÿï½¤ç¸ºï½§ç¸ºï½ªç¸ºãƒ»Â€ï½¤ç¹§å‘ˆæ‹ èœ·ï½¦ç¸ºå¶ï½‹

2026-02-12 02:03:10 [[32minfo[39m]: ç¹ãƒ»ãƒ»ç¹§ï½¿ç¹å¶ãƒ»ç¹§ï½¹è¬—ï½¥é‚¯å£¹â€²è±ï½£èŸ¶ï½¸ç¸ºï½«é’ï½ºé¶ä¹ï¼†ç¹§å¾Œâˆªç¸ºåŠ±â—† {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: éšªï½­è³å£¼Â€ï½¤ç¸ºï½®éš´ï½¦èœ»ãƒ» {"0":"Geminiç¹§å‰ƒï½½ï½¿é€•ï½¨ç¸ºå¶ï½‹ç¸ºï½«ç¸ºï½¯ [REDACTED] ç¸ºæ‚Ÿï½¿ãƒ»ï½¦âˆšã€’ç¸ºãƒ»,"service":"fairguard-bot"}
2026-02-12 02:03:10 [[32minfo[39m]: ç¹ãƒ»ãƒ»ç¹§ï½¿ç¹å¶ãƒ»ç¹§ï½¹è¬—ï½¥é‚¯å£¹â€²è±ï½£èŸ¶ï½¸ç¸ºï½«é’ï½ºé¶ä¹ï¼†ç¹§å¾Œâˆªç¸ºåŠ±â—† {"service":"fairguard-bot"}
PASS tests/utils/permissions.test.js
  Permissions
    ç«ãƒ»é‚‚ï½¡é€…ãƒ»Â€ãƒ»Î˜ç¹ï½¼ç¹§ï½¶ç¹ï½¼IDç¹§å‘ˆæˆŸç¸ºï½¤ç¹ï½¡ç¹ï½³ç¹èˆŒãƒ»ç¸ºï½¯é‚‚ï½¡é€…ãƒ»Â€ãƒ»â†’ç¸ºåŠ±â€»éš±å´ï½­å€¥ï¼†ç¹§å¾Œï½‹ (13 ms)
    ç«ãƒ»é‚‚ï½¡é€…ãƒ»Â€ãƒ»ÎŸç¹ï½¼ç¹ï½«ç¹§å‘ˆæˆŸç¸ºï½¤ç¹ï½¡ç¹ï½³ç¹èˆŒãƒ»ç¸ºï½¯é‚‚ï½¡é€…ãƒ»Â€ãƒ»â†’ç¸ºåŠ±â€»éš±å´ï½­å€¥ï¼†ç¹§å¾Œï½‹
    ç«ãƒ»é‚‚ï½¡é€…ãƒ»Â€ãƒ»ã€’ç¸ºï½ªç¸ºãƒ»Î“ç¹ï½³ç¹èˆŒãƒ»ç¸ºï½¯é‚‚ï½¡é€…ãƒ»Â€ãƒ»â†’ç¸ºåŠ±â€»éš±å´ï½­å€¥ï¼†ç¹§å¾Œâ†‘ç¸ºãƒ»(1 ms)
    ç«ãƒ»nullç¹ï½¡ç¹ï½³ç¹èˆŒãƒ»ç¸ºï½¯é‚‚ï½¡é€…ãƒ»Â€ãƒ»â†’ç¸ºåŠ±â€»éš±å´ï½­å€¥ï¼†ç¹§å¾Œâ†‘ç¸ºãƒ»(1 ms)
    ç«ãƒ»undefinedç¹ï½¡ç¹ï½³ç¹èˆŒãƒ»ç¸ºï½¯é‚‚ï½¡é€…ãƒ»Â€ãƒ»â†’ç¸ºåŠ±â€»éš±å´ï½­å€¥ï¼†ç¹§å¾Œâ†‘ç¸ºãƒ»
PASS tests/config.test.js
  config module validation
    ç«ãƒ»validateEnv returns missing keys when env vars not set (274 ms)
    ç«ãƒ»validateEnv returns no missing when env vars are set with valid formats (63 ms)

2026-02-12 02:03:10 [[32minfo[39m]: ç¹ãƒ»ãƒ»ç¹§ï½¿ç¹å¶ãƒ»ç¹§ï½¹è¬—ï½¥é‚¯å£¹â€²è±ï½£èŸ¶ï½¸ç¸ºï½«é’ï½ºé¶ä¹ï¼†ç¹§å¾Œâˆªç¸ºåŠ±â—† {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[32minfo[39m]: ç¹ãƒ»ãƒ»ç¹§ï½¿ç¹å¶ãƒ»ç¹§ï½¹è¬—ï½¥é‚¯å£¹â€²è±ï½£èŸ¶ï½¸ç¸ºï½«é’ï½ºé¶ä¹ï¼†ç¹§å¾Œâˆªç¸ºåŠ±â—† {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[32minfo[39m]: ç¹ãƒ»ãƒ»ç¹§ï½¿ç¹å¶ãƒ»ç¹§ï½¹è¬—ï½¥é‚¯å£¹â€²è±ï½£èŸ¶ï½¸ç¸ºï½«é’ï½ºé¶ä¹ï¼†ç¹§å¾Œâˆªç¸ºåŠ±â—† {"service":"fairguard-bot"}
PASS tests/utils/rateLimit.test.js
  Rate Limit
    ç«ãƒ»è­ï½°ç¸ºåŠ±ï¼ç¹ï½¦ç¹ï½¼ç¹§ï½¶ç¹ï½¼ç¸ºï½¯ç¹ï½¬ç¹ï½¼ç¹äº¥å®›é«¯èˆŒï½’é¨¾å¤â„ƒç¸ºï½§ç¸ºé˜ªï½‹ (306 ms)
    ç«ãƒ»ç¹ï½¬ç¹ï½¼ç¹äº¥å®›é«¯ä»™ãƒ»ç¸ºï½®ç¹ï½¦ç¹ï½¼ç¹§ï½¶ç¹ï½¼ç¸ºï½¯é¨¾å¤â„ƒç¸ºï½§ç¸ºé˜ªï½‹ (88 ms)
    ç«ãƒ»ç¹ï½¬ç¹ï½¼ç¹äº¥å®›é«¯èˆŒâ†“é©•æ–ï¼ ç¸ºæº˜Î˜ç¹ï½¼ç¹§ï½¶ç¹ï½¼ç¸ºï½¯ç¹æ‚¶ÎŸç¹ãƒ»ã‘ç¸ºè¼”ï½Œç¹§ãƒ»(70 ms)
    ç«ãƒ»è­ã‚‹ä¿£é¯è–™ï½’é©•å¼±â„ƒç¸ºæº˜Î˜ç¹ï½¼ç¹§ï½¶ç¹ï½¼ç¸ºï½¯ç¹ï½ªç¹§ï½»ç¹ãƒ»ãƒ¨ç¸ºè¼”ï½Œç¹§ãƒ»(70 ms)

2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
PASS tests/utils/cache.test.js
  TTLCache
    ç«ãƒ»è›Ÿï½¤ç¹§å®šï½¨ï½­è³å£¹ï¼ ç¸ºï½¦èœ¿é–€ï½¾åŠ±ã€’ç¸ºé˜ªï½‹ (18 ms)
    ç«ãƒ»è­›æ»„å‰è›»ãƒ»ï½Œç¸ºï½®è›Ÿï½¤ç¸ºï½¯èœ¿é–€ï½¾åŠ±ã€’ç¸ºé˜ªâ†‘ç¸ºãƒ»(159 ms)
    ç«ãƒ»hasç¹ï½¡ç¹§ï½½ç¹ãƒ»ãƒ©ç¸ºæ¢§ï½­ï½£ç¸ºåŠ±ï¿¥èœç©‚ï½½æ‡Šâ˜†ç¹§ãƒ»(1 ms)
    ç«ãƒ»deleteç¹ï½¡ç¹§ï½½ç¹ãƒ»ãƒ©ç¸ºæ¢§ï½­ï½£ç¸ºåŠ±ï¿¥èœç©‚ï½½æ‡Šâ˜†ç¹§ãƒ»(2 ms)
    ç«ãƒ»clearç¹ï½¡ç¹§ï½½ç¹ãƒ»ãƒ©ç¸ºå¾Œâ˜†ç¸ºï½¹ç¸ºï½¦ç¸ºï½®è›Ÿï½¤ç¹§è²ç‚é«¯ï½¤ç¸ºå¶ï½‹ (1 ms)
    ç«ãƒ»cleanupç¹ï½¡ç¹§ï½½ç¹ãƒ»ãƒ©ç¸ºæ¢§æ‚„é«¯ä»™ãƒ»ç¹§å¾Œãƒ»è›Ÿï½¤ç¹§è²ç‚é«¯ï½¤ç¸ºå¶ï½‹ (167 ms)
    ç«ãƒ»sizeç¹ï½¡ç¹§ï½½ç¹ãƒ»ãƒ©ç¸ºæ¢§ï½­ï½£ç¸ºåŠ±ï¼ç¹§ï½µç¹§ï½¤ç¹§ï½ºç¹§å®šï½¿æ–â˜† (2 ms)

2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE id = ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE id = ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE id = ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:10 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: INSERT INTO warning_records (id, user_id, timestamp, expires_at, reason, moderator_id, log_id) VALUES (?, ?, ?, ?, ?, ?, ?) {"service":"fairguard-bot"}
2026-02-12 02:03:11 [[33mwarn[39m]: Encryption skipped for positional parameters in table warning_records. Consider using named parameters for automatic encryption. SQL: DELETE FROM warning_records WHERE expires_at < ? {"service":"fairguard-bot"}
FAIL tests/services/warnings.test.js
  Warning System
    ï¾ƒãƒ»éš´ï½¦èœ»é¡˜ï½¿ï½½èœ‰ï£°ç¸ºï½§ç¹§ï½«ç¹§ï½¦ç¹ï½³ç¹åŒ»â€²è …æ€œåˆˆ (441 ms)
    ï¾ƒãƒ»éšãƒ»ç„šç¸ºï½®éš´ï½¦èœ»ç¿«ï½’éœ‘ï½½èœ‰ï£°ç¸ºå¶ï½‹ç¸ºï½¨ç¹§ï½«ç¹§ï½¦ç¹ï½³ç¹åŒ»â€²è …æ€œåˆˆ (130 ms)
    ç«ãƒ»éš´ï½¦èœ»ç¿«ï½’è²‚å¸™ï½‰ç¸ºå¶â†’ç¹§ï½«ç¹§ï½¦ç¹ï½³ç¹åŒ»â€²è²‚å¸›ï½°ãƒ»(124 ms)
    ç«ãƒ»èŸ„ä¼œæƒ ç¸ºåŠ±â†‘ç¸ºãƒ»Î˜ç¹ï½¼ç¹§ï½¶ç¹ï½¼ç¸ºï½®éš´ï½¦èœ»é ‘ç„šç¸ºï½¯0 (111 ms)
    ï¾ƒãƒ»éš´ï½¦èœ»ç¿«ï½’0è›ŸåŒºï½¸å¸™ï½‰ç¸ºæ˜´â‰§ç¸ºï½¨ç¸ºåŠ±â€»ç¹§ã‚…ãŠç¹ï½©ç¹ï½¼ç¸ºï½«ç¸ºï½ªç¹§å³¨â†‘ç¸ºãƒ»(123 ms)
    ï¾ƒãƒ»ç¹åŒ»Î›ç¹ï½³ç¹§ï½¶ç¹§ï½¯ç¹§ï½·ç¹ï½§ç¹ï½³ç¸ºæ‚Ÿï½¤ï½±è¬¨åŠ±ï¼ ç¸ºæº·ï£°ï½´èœ·åŒ»ãƒ»ç¹ï½­ç¹ï½¼ç¹ï½«ç¹èˆŒãƒ£ç¹§ï½¯ (121 ms)
    ï¾ƒãƒ»è­›ç‰™æŸ‘è­›æ»„å‰è›»ãƒ»ï½Œç¸ºï½®éš´ï½¦èœ»ç¿«ãƒ»é–¾ï½ªèœæ…•å™ªç¸ºï½«èœ‘ä¼å‹ç¸ºè¼”ï½Œç¹§ãƒ»(123 ms)

  ç¬³ãƒ»Warning System çª¶ï½º éš´ï½¦èœ»é¡˜ï½¿ï½½èœ‰ï£°ç¸ºï½§ç¹§ï½«ç¹§ï½¦ç¹ï½³ç¹åŒ»â€²è …æ€œåˆˆ

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 3

      84 |         const count = addWarning(userId, 'ç¹ãƒ»ã›ç¹éƒï½­ï½¦èœ»ãƒ», 'mod123', 'log123');
      85 |         
    > 86 |         expect(count).toBe(1);
         |                       ^
      87 |         expect(getActiveWarningCount(userId)).toBe(1);
      88 |     });
      89 |     

      at Object.toBe (tests/services/warnings.test.js:86:23)

  ç¬³ãƒ»Warning System çª¶ï½º éšãƒ»ç„šç¸ºï½®éš´ï½¦èœ»ç¿«ï½’éœ‘ï½½èœ‰ï£°ç¸ºå¶ï½‹ç¸ºï½¨ç¹§ï½«ç¹§ï½¦ç¹ï½³ç¹åŒ»â€²è …æ€œåˆˆ

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 5

      92 |         
      93 |         addWarning(userId, 'éš´ï½¦èœ»ãƒ»', 'mod123', 'log1');
    > 94 |         expect(getActiveWarningCount(userId)).toBe(1);
         |                                               ^
      95 |         
      96 |         addWarning(userId, 'éš´ï½¦èœ»ãƒ»', 'mod123', 'log2');
      97 |         expect(getActiveWarningCount(userId)).toBe(2);

      at Object.toBe (tests/services/warnings.test.js:94:47)

  ç¬³ãƒ»Warning System çª¶ï½º éš´ï½¦èœ»ç¿«ï½’0è›ŸåŒºï½¸å¸™ï½‰ç¸ºæ˜´â‰§ç¸ºï½¨ç¸ºåŠ±â€»ç¹§ã‚…ãŠç¹ï½©ç¹ï½¼ç¸ºï½«ç¸ºï½ªç¹§å³¨â†‘ç¸ºãƒ»
    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 3

      129 |         
      130 |         const count = reduceWarning(userId, 0);
    > 131 |         expect(count).toBe(1); // èŸç”»å³©ç¸ºï½ªç¸ºãƒ»[39m
          |                       ^
      132 |     });
      133 |     
      134 |     test('ç¹åŒ»Î›ç¹ï½³ç¹§ï½¶ç¹§ï½¯ç¹§ï½·ç¹ï½§ç¹ï½³ç¸ºæ‚Ÿï½¤ï½±è¬¨åŠ±ï¼ ç¸ºæº·ï£°ï½´èœ·åŒ»ãƒ»ç¹ï½­ç¹ï½¼ç¹ï½«ç¹èˆŒãƒ£ç¹§ï½¯', () => {

      at Object.toBe (tests/services/warnings.test.js:131:23)

  ç¬³ãƒ»Warning System çª¶ï½º ç¹åŒ»Î›ç¹ï½³ç¹§ï½¶ç¹§ï½¯ç¹§ï½·ç¹ï½§ç¹ï½³ç¸ºæ‚Ÿï½¤ï½±è¬¨åŠ±ï¼ ç¸ºæº·ï£°ï½´èœ·åŒ»ãƒ»ç¹ï½­ç¹ï½¼ç¹ï½«ç¹èˆŒãƒ£ç¹§ï½¯

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 3

      139 |         // è±ï½£èŸ¶ï½¸ç¸ºï½ªç¹§ï½±ç¹ï½¼ç¹§ï½¹
      140 |         addWarning(userId, 'è±ï½£èŸ¶ï½¸ç¸ºï½ªéš´ï½¦èœ»ãƒ», 'mod123', 'log1');
    > 141 |         expect(getActiveWarningCount(userId)).toBe(1);
          |                                               ^
      142 |         
      143 |         // è¾Ÿï½¡èœ‰ï½¹ç¸ºï½ªç¹ãƒ»ãƒ»ç¹§ï½¿ç¸ºï½§ç¹§ï½¨ç¹ï½©ç¹ï½¼ç¸ºæªåŒ±é€•æº˜â˜†ç¹§å¥ï£°ï½´èœ·èŒ¨ï½¼äº¥ï½®æ»„åœ€ç¸ºï½®è³æº¯ï½£ãƒ»ã€’ç¸ºï½¯ç¸²âˆšãƒ°ç¹ï½ªç¹ãƒ»ãƒ»ç¹§ï½·ç¹ï½§ç¹ï½³ç¸ºï½§é«¦ï½²ç¸ºå¾Œï½Œç¹§å…·ï½¼ãƒ»[39m
      144 |         // ç¸ºè–™ãƒ»ç¹ãƒ»ã›ç¹åŒ»ãƒ»ç¸²âˆšãƒ¨ç¹ï½©ç¹ï½³ç¹§ï½¶ç¹§ï½¯ç¹§ï½·ç¹ï½§ç¹ï½³ç¸ºï½®è¬¨ï½´èœ·åŸŸÂ€ï½§ç¸ºå¾¡ï½¿æ˜´â—†ç¹§å¾Œï½‹ç¸ºè–™â†’ç¹§å ¤ï½¢ï½ºéš±é˜ªâ˜†ç¹§ä¹â—†ç¹§âˆšãƒ»ç¹§ã‚…ãƒ»ç¸ºï½§ç¸ºãƒ»[39m

      at Object.toBe (tests/services/warnings.test.js:141:47)

  ç¬³ãƒ»Warning System çª¶ï½º è­›ç‰™æŸ‘è­›æ»„å‰è›»ãƒ»ï½Œç¸ºï½®éš´ï½¦èœ»ç¿«ãƒ»é–¾ï½ªèœæ…•å™ªç¸ºï½«èœ‘ä¼å‹ç¸ºè¼”ï½Œç¹§ãƒ»
    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 3

      150 |         // éš´ï½¦èœ»ç¿«ï½’éœ‘ï½½èœ‰ï£°
      151 |         addWarning(userId, 'éš´ï½¦èœ»ãƒ»', 'mod123', 'log1');
    > 152 |         expect(getActiveWarningCount(userId)).toBe(1);
          |                                               ^
      153 |         
      154 |         // è±•ï½¨è«¢ãƒ» è³æ»„åœ€ç¸ºï½®è³æº¯ï½£ãƒ»ã€’ç¸ºï½¯ç¸²âˆ¬ï½­ï½¦èœ»ç¿«ãƒ»30è­Œï½¥ç¸ºï½§èŸï½±èœ‰ï½¹ç¸ºåŠ±âˆªç¸ºãƒ»[39m
      155 |         // ç¸ºè–™ãƒ»ç¹ãƒ»ã›ç¹åŒ»ã€’ç¸ºï½¯ç¸²â€¦leanupExpiredWarningsç¸ºæ¢§ï½­ï½£ç¸ºåŠ±ï¿¥èœç©‚ï½½æ‡Šâ˜†ç¹§ä¹ï¼…ç¸ºï½¨ç¹§å ¤ï½¢ï½ºéš±é˜ªï¼ ç¸ºï½¾ç¸ºãƒ»[39m

      at Object.toBe (tests/services/warnings.test.js:152:47)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 1 failed, 6 passed, 7 total
Tests:       5 failed, 40 passed, 45 total
Snapshots:   0 total
Time:        3.845 s, estimated 4 s
Ran all test suites.
