## ✨ 主な機能

このBotは、`better-sqlite3` をデータベースとして使用し、Google の **Gemini API** を活用することで、高度な自動・半自動モデレーションを実現します。

1.  **AIハイブリッドモデレーション**:
      * **ブラックリスト**: 設定された禁止ワードに一致した場合、即座に削除・警告を発行します。
      * **グレーリスト (AI審議)**: 潜在的な攻撃的ワード（「死ね」など）に対して、**メッセージの文脈**をAIが判断し、**ハラスメント意図がある場合のみ**警告を発行します。
      * **連投・長文投稿検出**: 短期間のスパム行為や過度な長文投稿をAIが検知し、自動で警告を発行します。
2.  **警告システムと自動処罰**:
      * 警告はデータベースに永続的に記録され、自動的に**30日で失効**します。
      * 警告が設定回数（デフォルト: 3回）を超えると、自動でメッセージ削除などの処罰が実行されます。
3.  **警告の異議申し立てシステム**:
      * ユーザーは Bot から受けた警告に対し、`/appeal` または `!appeal` コマンドで**異議申し立て**が可能です。
      * AIが、元の警告理由、ユーザーの言い分、そして**発言の文脈**を総合的に判断し、公平な「審判」を下します。
4.  **モデレーター権限濫用チェック**:
      * 管理者が手動で警告 (`/warn` または `!warn`) を発行する際、AIが警告の理由や頻度をチェックし、**不適切な警告**である可能性を通知し、第三者的な視点を提供します。
5.  **サポートチケットシステム**:
      * `/ticket open` または `!ticket open` で管理者にプライベートにお問い合わせできるチケットチャンネルを作成できます。
6.  **モダンなコマンドシステム**:
      * スラッシュコマンド（`/command`）とプレフィックスコマンド（`!command`）の両方をサポート
      * スラッシュコマンドは引数の自動補完とバリデーション機能を提供

-----

## 🛠️ セットアップ

### 1\. 依存関係のインストール

Node.js v18以上が必要です。

```bash
npm install discord.js better-sqlite3 dotenv
```

### 2\. 環境変数 (.env)

プロジェクトのルートディレクトリに `.env` ファイルを作成し、以下の変数を設定してください。

```dotenv
# Discord Bot
BOT_TOKEN="YOUR_DISCORD_BOT_TOKEN"
DISCORD_GUILD_ID="あなたのサーバーのID" 
DISCORD_ADMIN_ROLE_ID="管理者が持っているロールのID"
DISCORD_ALERT_CHANNEL_ID="警告・ログを通知するチャンネルのID"
DISCORD_TICKET_CATEGORY_ID="チケットチャンネルを作成するカテゴリのID"
DISCORD_ADMIN_USER_IDS="任意：ロールに関わらず管理者権限を持つユーザーIDをカンマ区切りで指定"

# AI Configuration (Google Gemini)
GEMINI_API_KEY="YOUR_GEMINI_API_KEY"
```

### 3\. スラッシュコマンドの登録

Botを起動する前に、スラッシュコマンドをDiscordに登録する必要があります。

```bash
node scripts/deploy-commands.js
```

**注意**: コマンドの変更や追加を行った場合は、このスクリプトを再実行してください。

### 4\. 実行

```bash
node index.js
```

（PM2などのプロセス管理ツールでの実行を推奨します）

-----

## 📜 コマンド一覧

このBotは**スラッシュコマンド**（`/command`）と**プレフィックスコマンド**（`!command`）の両方をサポートしています。

### スラッシュコマンド（推奨）

Discordのネイティブ機能を使用したモダンなコマンドシステムです。

#### 👤 ユーザー用コマンド

- `/help` - コマンド一覧を表示
- `/appeal <log_id> <reason>` - 警告に対する異議申し立て
- `/ticket open` - サポートチケットを作成

#### 👮 管理者用コマンド

- `/warn <user> [reason] [message_id]` - ユーザーに警告を発行
- `/unwarn <user_id> [amount]` - ユーザーの警告を削減
- `/addword <word> [type]` - 禁止ワードを追加（type: `black` または `gray`）
- `/removeword <word>` - 禁止ワードを削除
- `/listword` - 禁止ワード一覧を表示
- `/timeout <user_id>` - ユーザーをタイムアウト
- `/cmdlog [limit]` - コマンド履歴を表示（最大50件）
- `/warnlog [user_id] [limit]` - 警告履歴を表示（最大50件）
- `/ticket close` - チケットを閉鎖

### プレフィックスコマンド（従来方式）

従来の `!` プレフィックスコマンドも引き続き利用可能です。

- `!help` - コマンド一覧を表示
- `!appeal <ID> <理由>` - 異議申し立て
- `!ticket open` - チケット作成
- `!warn <@user> [理由]` - 手動警告（管理者専用）
- `!unwarn <ユーザーID> [数]` - 警告削減（管理者専用）
- `!addword <単語> [black/gray]` - ワード追加（管理者専用）
- `!removeword <単語>` - ワード削除（管理者専用）
- `!listword` - 一覧表示（管理者専用）
- `!timeout_user <ユーザーID>` - タイムアウト（管理者専用）
- `!cmdlog [件数]` - コマンド履歴（管理者専用）
- `!warnlog [ユーザーID] [件数]` - 警告履歴（管理者専用）
- `!ticket close` - チケット終了（管理者専用）

-----

## 📁 プロジェクト構造

このプロジェクトはモジュール化されており、保守性と拡張性を重視した設計になっています。

```
FairGuard-Bot/
├── index.js              # メインファイル（Botの起動とイベント処理）
├── config.js             # 設定と環境変数チェック
├── database.js           # データベース初期化
├── commands/             # スラッシュコマンド定義
│   └── commands.js
├── handlers/             # イベントハンドラー
│   ├── commands.js       # プレフィックスコマンド処理
│   ├── slashCommands.js  # スラッシュコマンド処理
│   ├── interactions.js   # ボタンインタラクション処理
│   └── moderation.js     # モデレーション処理
├── services/             # ビジネスロジック
│   ├── ai.js            # Gemini API、AI判定
│   └── warnings.js      # 警告管理
├── utils/               # ユーティリティ関数
│   ├── bannedWords.js   # 禁止ワード管理
│   ├── logs.js          # ログ保存
│   ├── permissions.js   # 権限チェック
│   ├── rateLimit.js     # レート制限
│   └── tickets.js       # チケット管理
└── scripts/             # ユーティリティスクリプト
    └── deploy-commands.js # スラッシュコマンド登録
```

## 🚧 開発者の小言 (The Dev's Monologue)

このBotは、当初、**とある特定のサーバーのために**、手間暇かけて開発されたモデレーションシステムです。

特に、高性能なAI（Google Gemini）を組み込むことで、感情的なモデレーションや誤爆を減らし、**公平で洗練されたコミュニティ運営**を目指し、機能の洗練に多くの時間を費やしました。

しかし、開発期間中のコミュニケーションや事前の告知もなく、ある日突然、Botがサーバーから追い出されました。

「特定のコミュニティのために無償で提供した労力が、一方的な理由で切り捨てられた」という結論に至ったため、作業が割に合わないと判断し、このプロジェクトは**オープンソース**として公開することにしました。

特定のコミュニティのためだけに作られたシステムですが、自由に使ってください。

しかも異議申し立てシステムが私が絶対に取り消されるようにAI操作してるみたいないちゃもんつけてくるし、
